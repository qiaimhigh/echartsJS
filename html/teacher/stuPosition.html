<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基层管理平台</title>
    <link rel="stylesheet" href="../../css/teaindex.css">
    <script src="https://api.map.baidu.com/api?v=1.0&&type=webgl&ak=RNj6jwv9wNUwFgwtGvgfXFEYjxNV7d23"
        type="text/javascript" charset="utf-8"></script>
    <script src="../../font/iconfont.js"></script>

</head>

<body>
    <div class="nav-left">
        <div>
            <div class="header-item">
                <svg style="display: inline; width: 60px; height: 60px;" aria-hidden="true">
                    <use xlink:href="#icon-huasheng"></use>
                </svg>
                绿马管理平台
            </div>
            <div class="left-item">
                <a href="./mijieTable.html">密接人员信息</a>
            </div>
            <div class="left-item active">
                <a href="./stuPositionIndex.html">人员行程查询</a>
            </div>
            <div class="left-item">
                <a href="./testreport.html">未作核酸人员</a>
            </div>
        </div>
        <div style="font-size: 13px; color: white; text-align: center;">
            @XUPT 西邮绿马平台
        </div>
    </div>
    <div class="right-content">
        <div id="container"></div>
    </div>

    <script src="../../js/jquery.js"></script>
    <script type="text/javascript">
        console.log(window.location.href.split('=')[1]);
        $.get("https://xiyoulvma.xyz/personmanage/scatterplot", { id: window.location.href.split('=')[1] }, (data, status) => {
            var map = new BMapGL.Map("container");
            // var point = new BMapGL.Point(116.404, 39.915);
            var point = new BMapGL.Point(108.88, 34.13);
            map.centerAndZoom(point, 15);
            map.enableScrollWheelZoom(true);
            var scaleCtrl = new BMapGL.ScaleControl();  // 添加比例尺控件
            map.addControl(scaleCtrl);
            var zoomCtrl = new BMapGL.ZoomControl();  // 添加缩放控件
            map.addControl(zoomCtrl);
            var cityCtrl = new BMapGL.CityListControl();  // 添加城市列表控件
            map.addControl(cityCtrl);

            console.log(data);
            let temp = 0;
            let arr = [];
            data.forEach(personList => {
                // console.log(x.p_trip);
                personList.p_trip.forEach((position, index) => {
                    var point = new BMapGL.Point(position.x, position.y);
                    // positionArr.push(point)
                    var marker = new BMapGL.Marker(point);        // 创建标注   
                    map.addOverlay(marker);
                    var driving = new BMapGL.DrivingRoute(map, { renderOptions: { map: map, autoViewport: true } });
                    if (temp < personList.p_trip.length - 1) {
                        driving.search(new BMapGL.Point(position.x, position.y), new BMapGL.Point(personList.p_trip[index + 1].x, personList.p_trip[index + 1].y));
                        temp++;
                    }
                    arr.push([{
                        'lng': position.x,
                        'lat': position.y
                    }])                                // 将标注添加到地图中
                })
            });
            console.log(arr);
        })
    </script>


</body>

</html>