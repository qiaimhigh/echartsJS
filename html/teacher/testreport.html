<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基层管理平台</title>
    <script src="../../js/jquery.js"></script>
    <link rel="stylesheet" href="../../css/teaindex.css">
    <link rel="stylesheet" href="../../css/bootstrap.css">
    <script src="../../font/iconfont.js"></script>
</head>

<body>
    <div class="nav-left">
        <div>
            <div class="header-item">
                <svg style="display: inline; width: 60px; height: 60px;" aria-hidden="true">
                    <use xlink:href="#icon-huasheng"></use>
                </svg>
                绿马管理平台
            </div>
            <div class="left-item">
                <a href="./mijieTable.html">密接人员信息</a>
            </div>
            <div class="left-item">
                <a href="./stuPositionIndex.html">患者个人信息</a>
            </div>
            <div class="left-item active">
                <a href="./testreport.html">未做核酸人员</a>
            </div>
        </div>
        <div style="font-size: 13px; color: white; text-align: center;">
            @XUPT 西邮绿马平台
        </div>
    </div>

    <div class="right-content">
        <div class="select">
            <input type="text" id="input" placeholder="请输入身份证号或者名字">
            <div class="ox" onclick="selectFun()" style="cursor: pointer;">
                <img src="../../img/搜索 1.png" alt="">
                搜索
            </div>
        </div>
        <div class="list-body">
            <ul id="route">
                <li class="infList">
                    <div>姓名</div>
                    <div>电话号码</div>
                    <div>身份证号</div>
                    <div>性别</div>
                    <div>小区</div>
                    <div>门牌号</div>
                    <div>不做理由</div>
                </li>
            </ul>
        </div>
        <div class="page-body">
            <div class="totalInf">
                <i></i>
                <p>共<span id="totalPage"></span>页数据</p>
            </div>
            <div class="list">
                <ul class="pagination" id="pageNum">
                </ul>
            </div>
        </div>
    </div>
    <script>
        function panDuan(sex) {
            return sex === true ? '男' : '女'
        }
        function selectFun(){
            load(1,$('#input').val().trim())
        }
        function chuLi(value){
            if(value == '无' || value){
                return '错过核酸时间'
            }
        }
    
        function load(id,data) {
            let obj = {};
            if(data===''){
                obj = {
                    page: id
                };
            }else{
                obj= {
                    page: id,
                    data: data
                };
            }
            $.get("https://xiyoulvma.xyz/personmanage/untest_data",obj, function (data) {
                let pd = JSON.parse(data)
                console.log(pd);
                // 解析数据
                // 1.分页数据条展示
                // $("#totalCount").html(pb.totalCount);
                $("#totalPage").html(pd.totalPage);
                var lis = ""
                var firstPage = '<li onclick="javascript:load(1)"><a href="javascript:void(0)">首页</a></li>'
                // 计算上一页
                var before = pd.currentPage - 1;
                if (before <= 0) {
                    before = 1;
                }
                var beforePage = '<li onclick="javascript:load(' + before + ')" class="threeword"> <a href="#">上一页</a></li>'
                lis += firstPage;
                lis += beforePage;

                // 定义开始位置，结束位置  一共显示10条数据
                var begin;
                var end;
                if (pd.totalPage < 10) {
                    begin = 1;
                    end = pd.totalPage;
                }
                else {
                    begin = pd.currentPage - 5;
                    end = pd.currentPage + 4;

                    // 补齐
                    if (begin < 1) {
                        begin = 1;
                        end = begin + 9;
                    }
                    if (end > pd.totalPage) {
                        end = pd.totalPage;
                        begin = end - 9;
                    }

                }
                for (var i = begin; i <= end; i++) {
                    if (pd.currentPage == i) {
                        var li = '<li class="curPage" onclick="load(' + i + ')"><a>' + i + '</a></li>'
                    }
                    else {
                        var li = '<li onclick="load(' + i + ')"><a>' + i + '</a></li>'
                    }
                    lis += li;
                }
                var next = pd.currentPage + 1;
                if (next >= pd.totalPage) {
                    next = pd.totalPage;
                }
                var lastPage = '<li onclick="javascript:load(' + pd.totalPage + ')" class="threeword"><a href="javascript:;">末页</a></li>'
                var nextPage = '<li onclick="javascript:load(' + next + ')"  class="threeword"><a href="javascript:;">下一页</a></li>'
                lis += nextPage;
                lis += lastPage;
                $("#pageNum").html(lis)

                var route_lis = "";
                for (var i = 0; i < pd.data.length; i++) {
                    var route = pd.data[i];
                    var li = `
                    <li class="infList">
                        <div>${pd.data[i].name}</div>
                        <div>${panDuan( pd.data[i].sex)}</div>
                        <div>${pd.data[i].id_number}</div>
                        <div>${pd.data[i].phone}</div>
                        <div>${pd.data[i].community_name}</div>
                        <div>${pd.data[i].building}单元${pd.data[i].door}室</div>
                        <div>${chuLi(pd.data[i].difficult)}</div>
                    </li>
                    `;
                    route_lis += li;
                }
                $("#route").html(` <li class="infList" style="font-size: 20px;">
                    <div>姓名</div>
                    <div>性别</div>
                    <div>身份证号码</div>
                    <div>电话号码</div>
                    <div>所在小区</div>
                    <div>门牌号</div>
                    <div>不做理由</div>
                </li>${route_lis}`);

            })
        }
        load(1)
    </script>
</body>

</html>